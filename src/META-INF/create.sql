CREATE TABLE IF NOT EXISTS `project_files`( `fileid` VARCHAR(255) NOT NULL, `projectid` VARCHAR(32) NOT NULL, `filepath` VARCHAR(255) NOT NULL DEFAULT '', `filename` VARCHAR(255) NOT NULL DEFAULT '', `releaseid` BIGINT(20) UNSIGNED NOT NULL, `type` ENUM('raw','report','result') DEFAULT NULL, `description` TEXT, `hidden` boolean NOT NULL DEFAULT 0, `file_group` VARCHAR(255) NULL DEFAULT NULL, PRIMARY KEY (`fileid`), INDEX `FK_project_files_project_membership` (`projectid`), INDEX `FK_project_files_release` (`releaseid`),	INDEX `files_path` (`filepath`), CONSTRAINT `FK_project_files_project_membership` FOREIGN KEY (`projectid`) REFERENCES `project_membership` (`projectid`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `FK_project_files_release` FOREIGN KEY (`releaseid`) REFERENCES `project_release` (`releaseid`) ON UPDATE CASCADE ON DELETE CASCADE ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE TABLE IF NOT EXISTS `project_membership`( `projectid` varchar(32) NOT NULL, `userid` varchar(128) NOT NULL,  `owner` tinyint(1) NOT NULL DEFAULT 0, PRIMARY KEY (`projectid`,`userid`), KEY `FK_project_membership_users` (`userid`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE TABLE IF NOT EXISTS `project_release`( `releaseid` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT, `title` VARCHAR(255) NOT NULL, `released_by` varchar(128) NOT NULL, `release_date` date DEFAULT '1900-01-01', `description` text, PRIMARY KEY (`releaseid`), INDEX `release_date` (`release_date`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE TABLE IF NOT EXISTS `users`( `userid` varchar(128) NOT NULL, `name` varchar(255) DEFAULT NULL, `pass` varchar(48) NULL, `affiliation` varchar(32) DEFAULT NULL, `role` ENUM('admin','customer') DEFAULT 'customer', `token` varchar(64) DEFAULT NULL, PRIMARY KEY (`userid`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE TABLE IF NOT EXISTS `ssh_keys`( `userid` VARCHAR(128) NOT NULL, `ssh_key` TEXT NOT NULL, `md5_hash` VARCHAR(48) NOT NULL, `sha256_hash` VARCHAR(48) NOT NULL, `date_added` DATETIME NOT NULL, INDEX `FK__users_ssh_keys` (`userid`), UNIQUE INDEX `ssh_sha256` (`sha256_hash`), UNIQUE INDEX `ssh_md5` (`md5_hash`), CONSTRAINT `FK__users_ssh_keys` FOREIGN KEY (`userid`) REFERENCES `users` (`userid`) ON UPDATE CASCADE ON DELETE CASCADE) ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE TABLE IF NOT EXISTS `uploaded_files`( `file_id` VARCHAR(255) NOT NULL, `project_id` varchar(32) NOT NULL, `userid` varchar(128) NOT NULL, `upload_date` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, PRIMARY KEY (`file_id`), CONSTRAINT `uploads_users` FOREIGN KEY (`userid`) REFERENCES `users` (`userid`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8;